name: daily-youtube-leads

on:
  schedule:
    # GitHub cron 使用 UTC。01:00 UTC = 北京时间 09:00
    - cron: "0 1 * * *"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: daily-youtube-leads
  cancel-in-progress: false

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: Restore done_channel_ids.txt from data branch (if exists)
        shell: bash
        run: |
          set -euo pipefail
          if git ls-remote --exit-code --heads origin data >/dev/null 2>&1; then
            echo "Remote data branch exists. Restoring done_channel_ids.txt ..."
            git fetch origin data
            git show origin/data:done_channel_ids.txt > done_channel_ids.txt || true
          else
            echo "Remote data branch does not exist yet. Creating fresh done_channel_ids.txt"
            : > done_channel_ids.txt
